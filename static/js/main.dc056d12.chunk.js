(this["webpackJsonpreact-with-leaflet"]=this["webpackJsonpreact-with-leaflet"]||[]).push([[0],{48:function(e,t,n){e.exports=n(78)},77:function(e,t,n){},78:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(20),s=n.n(i),o=n(9),c=n.n(o),l=n(17),u=n(7),h=n(8),p=n(12),d=n(11),f=n(10),v=n(21),m=n.n(v),k=new(function(){function e(){Object(u.a)(this,e),this._data={}}return Object(h.a)(e,[{key:"add",value:function(e,t){this._data[e]=t}},{key:"get",value:function(e){return e in this._data?this._data[e]:[]}}]),e}());Object.freeze(k);var b=function(){function e(t){Object(u.a)(this,e),this.endpoint=t}return Object(h.a)(e,[{key:"apiCall",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.get(this.endpoint+t,{headers:{Accept:"application/vnd.vegvesen.nvdb-v3-rev1+json"}});case 2:n=e.sent,a=n.data.objekter,console.log(n);case 5:if(1e3!==n.data.metadata.returnert){e.next=12;break}return e.next=8,m.a.get(n.data.metadata.neste.href,{headers:{Accept:"application/vnd.vegvesen.nvdb-v3-rev1+json"}});case 8:n=e.sent,a=a.concat(n.data.objekter),e.next=5;break;case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"apiCallSingle",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.get(this.endpoint+t,{headers:{Accept:"application/vnd.vegvesen.nvdb-v3-rev1+json"}});case 2:return n=e.sent,a=n.data,console.log(n),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),g=n(38),y=n(43),j=n(39),O=n(42),w=n(41),C=n(40),M=n(46),E=n.n(M),x=(n(75),n(76),n(2)),S=n.n(x),F=function(e){Object(d.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this,e)).state={zoom:15,contextMenu:!1},n.handleClick=n.handleClick.bind(Object(p.a)(n)),n}return Object(h.a)(a,[{key:"render",value:function(){return r.a.createElement(g.a,{center:this.props.currentLocation,zoom:this.state.zoom,maxZoom:19,onclick:this.handleClick},r.a.createElement(y.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),this.drawIssueMarkers(this.props.issues),r.a.createElement(E.a,{spiderfyOnMaxZoom:!1,disableClusteringAtZoom:18},0!==this.props.filters.length&&this.drawMapObjects(this.props.map),this.drawRoads(this.props.roads)))}},{key:"drawIssueMarkers",value:function(e){var t=this;return e.map((function(e,n){return r.a.createElement(j.a,{position:e.geometry.coordinates,key:n,icon:t.getIcon()},r.a.createElement(O.a,null,e.properties.name+" "+e.properties.date))}))}},{key:"drawMapObjects",value:function(e){var t=this,a=n(44);return e.map((function(e,n){try{var i=a(e.geometri.wkt);if("Point"===i.type){var s=[i.coordinates[0],i.coordinates[1]];return r.a.createElement(j.a,{position:s,key:e.id,icon:t.getIcon(e.metadata.type.id),onClick:function(){t.props.handleMarkerClick(e)}})}if("LineString"===i.type){var o=Array.from(i.coordinates.map((function(e){return e.slice(0,2)})));return r.a.createElement(w.a,{color:"red",positions:o,key:n})}if("Polygon"===i.type){var c=i.coordinates;return r.a.createElement(C.a,{color:"red",positions:c,key:n})}return console.log("Invalid geoJSON: "+i.type),console.log(i),null}catch(l){return console.log(e),console.log(l),null}}))}},{key:"drawRoads",value:function(e){var t=n(44);return e.map((function(e,n){var a=t(e.geometri.wkt),i=Array.from(a.coordinates.map((function(e){return e.slice(0,2)})));return r.a.createElement(w.a,{color:"red",positions:i,key:n})}))}},{key:"getIcon",value:function(e){var t;t=e?this.rainbow(this.props.filters.length,this.props.filters.findIndex((function(t){return t.id===e}))):this.rainbow(1,1);var n="\n    background-color: ".concat(t,";\n    width: 2rem;\n    height: 2rem;\n    display: block;\n    left: -1.5rem;\n    top: -1.5rem;\n    position: relative;\n    border-radius: 3rem 3rem 0;\n    transform: rotate(45deg);\n    border: 1px solid #FFFFFF");return S.a.divIcon({className:"my-custom-pin",iconAnchor:[0,24],labelAnchor:[-6,0],popupAnchor:[0,-36],html:'<span style="'.concat(n,'" />')})}},{key:"handleClick",value:function(e){this.props.handleMapClick(e)}},{key:"rainbow",value:function(e,t){var n,a,r,i=t/e,s=~~(6*i),o=6*i-s,c=1-o;switch(s%6){case 0:n=1,a=o,r=0;break;case 1:n=c,a=1,r=0;break;case 2:n=0,a=1,r=o;break;case 3:n=0,a=c,r=1;break;case 4:n=o,a=0,r=1;break;case 5:n=1,a=0,r=c}return"#"+("00"+(~~(255*n)).toString(16)).slice(-2)+("00"+(~~(255*a)).toString(16)).slice(-2)+("00"+(~~(255*r)).toString(16)).slice(-2)}}]),a}(a.Component),I=n(28),L=function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).handleInputChange=function(e){var t=e.target.value;a.setState((function(e){var n=a.props.data.filter((function(e){return e.navn.toLowerCase().includes(t.toLowerCase())}));return{query:t,filteredData:n}}))},a.state={query:"",filteredData:[]},a.handleClickOutside=a.handleClickOutside.bind(Object(p.a)(a)),a}return Object(h.a)(n,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"searchField"},r.a.createElement("form",null,r.a.createElement("input",{className:"searchField-input",placeholder:"Search for...",value:this.state.query,onChange:this.handleInputChange})),r.a.createElement("div",{className:"searchfield-choices"},this.state.filteredData.map((function(t){return r.a.createElement("p",{key:t.id,className:"searchfield-choice",onClick:function(){e.handleSelect(t)}},t.navn)}))))}},{key:"handleClickOutside",value:function(e){this.setState({query:"",filteredData:[]})}},{key:"handleSelect",value:function(e){this.setState({query:"",filteredData:[]}),this.props.handleFilterSelect(e)}}]),n}(a.Component),D=Object(I.a)(L),R=function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(e){return Object(u.a)(this,n),t.call(this,e)}return Object(h.a)(n,[{key:"render",value:function(){var e=this;return this.props.filters.length>0?r.a.createElement("div",{className:"mapFilter"},r.a.createElement("div",null,"Vegobjekter"),this.props.filters.map((function(t){return r.a.createElement("div",{className:"mapFilter-entry",key:t.id},r.a.createElement("div",{className:"mapFilter-entry-name"},t.navn),r.a.createElement("button",{className:"mapFilter-entry-button",onClick:function(){e.props.handleRemoveFilter(t)}},"X"))})),r.a.createElement("div",null,"Filtrer..")):r.a.createElement("div",null)}}]),n}(a.Component),N=function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"render",value:function(){var e=this.props.showMarkerInfo;return e?r.a.createElement("div",{className:"dataDisplay"},r.a.createElement("p",null,e.metadata.type.navn),r.a.createElement("p",null,"ID: ",e.id),r.a.createElement("p",null," "),e.egenskaper.map((function(e){return e.verdi?r.a.createElement("p",{key:e.id},e.navn,": ",e.verdi):void 0})),r.a.createElement("div",null,r.a.createElement("button",null,"Rediger"),r.a.createElement("button",null,"Opprett Sak"))):r.a.createElement("div",null)}},{key:"handleClickOutside",value:function(e){this.props.handleClickOutside()}}]),n}(a.Component),P=Object(I.a)(N),T=function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).state={filters:[]},a.handleFilterSelect=a.handleFilterSelect.bind(Object(p.a)(a)),a.handleRemoveFilter=a.handleRemoveFilter.bind(Object(p.a)(a)),a}return Object(h.a)(n,[{key:"render",value:function(){return r.a.createElement("div",{className:"rightMenu"},r.a.createElement(D,{handleFilterSelect:this.handleFilterSelect,data:this.props.roadObjectTypes}),r.a.createElement(R,{filters:this.state.filters,handleRemoveFilter:this.handleRemoveFilter}),this.props.showMarkerInfo&&r.a.createElement(P,{showMarkerInfo:this.props.showMarkerInfo,handleClickOutside:this.props.handleClickOutside}))}},{key:"handleFilterSelect",value:function(e){var t=this.state.filters.concat(e);this.props.handleFilters(t),this.setState((function(){return{filters:t}}))}},{key:"handleRemoveFilter",value:function(e){var t=this.state.filters.filter((function(t){return t!==e}));this.props.handleFilters(t),this.setState((function(){return{filters:t}}))}}]),n}(a.Component),A=(a.Component,function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(e){return Object(u.a)(this,n),t.call(this,e)}return Object(h.a)(n,[{key:"render",value:function(){var e=this.props.details.x+"px",t=this.props.details.y+"px";return r.a.createElement("div",{className:"ContextMenu",style:{left:e,top:t}},r.a.createElement("button",{onClick:this.props.handleClick},"Hendelse"),r.a.createElement("button",null,"Nytt objekt"))}}]),n}(a.Component)),q=function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).state={contextMenu:{show:!1}},a.swiping=!1,a.handleMapClick=a.handleMapClick.bind(Object(p.a)(a)),a.handleContextClick=a.handleContextClick.bind(Object(p.a)(a)),a.handleMarkerClick=a.handleMarkerClick.bind(Object(p.a)(a)),a.closeDataDisplay=a.closeDataDisplay.bind(Object(p.a)(a)),a}return Object(h.a)(n,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"Container",onMouseDown:function(){e.swiping=!1},onMouseMove:function(){e.swiping=!0}},this.state.contextMenu.show&&r.a.createElement(A,{details:this.state.contextMenu,handleClick:this.handleContextClick}),r.a.createElement(T,{roadObjectTypes:this.props.roadObjectTypes,showMarkerInfo:this.state.showMarkerInfo,handleFilters:this.props.handleFilters,handleClickOutside:this.closeDataDisplay}),r.a.createElement(F,{currentLocation:this.props.currentLocation,map:this.props.map,filters:this.props.filters,roads:this.props.roads,issues:this.props.issues,handleMapClick:this.handleMapClick,handleMarkerClick:this.handleMarkerClick}))}},{key:"handleMarkerClick",value:function(e){this.setState({showMarkerInfo:e})}},{key:"handleMapClick",value:function(e){var t=e.originalEvent;!t.target.classList.contains("leaflet-container")||this.state.contextMenu.show||this.swiping?t.target.classList.contains("ContextMenu")||this.setState({contextMenu:{show:!1}}):this.setState({contextMenu:{show:!0,x:t.pageX,y:t.pageY,lat:e.latlng.lat,lng:e.latlng.lng}})}},{key:"handleContextClick",value:function(){this.setState((function(e){return{issueRegistration:!0,contextMenu:{show:!1,lat:e.contextMenu.lat,lng:e.contextMenu.lng}}}))}},{key:"closeDataDisplay",value:function(){this.setState({showMarkerInfo:void 0})}}]),n}(a.Component),z=(n(77),function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).state={nvdbEndpoint:"https://nvdbapiles-v3.utv.atlas.vegvesen.no/",currentLocation:{lat:60.0084857,lng:11.0648648},menu:"mainMenu",map:[],filters:[],roads:[],issues:[]},a.nvdb=new b(a.state.nvdbEndpoint),a.handleFilters=a.handleFilters.bind(Object(p.a)(a)),a.getUserLocation=a.getUserLocation.bind(Object(p.a)(a)),a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:navigator.geolocation.getCurrentPosition(this.getUserLocation),this.getRoadObjectTypes();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement(q,{currentLocation:this.state.currentLocation,map:this.state.map,filters:this.state.filters,roads:this.state.roads,issues:this.state.issues,roadObjectTypes:this.state.roadObjectTypes,handleFilters:this.handleFilters,handleRegistration:this.handleRegistration})}},{key:"getPolygonString",value:function(e){var t="";return e.forEach((function(e){t=t+e.lat+" "+e.lng+","})),t.slice(0,-1)}},{key:"getCircle",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=[],r=0,i=(2*Math.PI-r)/n,s=0;s<n;s++)a.push(r),r+=i;t/=6371,e={lat:e.lat*(Math.PI/180),lng:e.lng*(Math.PI/180)};var o=[];return a.forEach((function(n){var a,r=Math.asin(Math.sin(e.lat)*Math.cos(t)+Math.cos(e.lat)*Math.sin(t)*Math.cos(n));a=0===Math.cos(r)?e.lng:(e.lng-Math.asin(Math.sin(n)*Math.sin(t)/Math.cos(r))+Math.PI)%(2*Math.PI)-Math.PI,o.push({lat:r*(180/Math.PI),lng:a*(180/Math.PI)})})),o.push(o[0]),o}},{key:"getUserLocation",value:function(e){this.setState({currentLocation:{lat:e.coords.latitude,lng:e.coords.longitude}})}},{key:"handleFilters",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],this.setState({filters:t}),a=this.getPolygonString(this.getCircle(this.state.currentLocation)),t&&(t.forEach(function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.push(r.nvdb.apiCall("vegobjekter/"+t.id+"?inkluder=alle&srid=4326&polygon="+a));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Promise.all(n).then((function(e){r.setState({map:[].concat.apply([],e)})})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRoadObjectTypes",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.nvdb.apiCallSingle("vegobjekttyper");case 2:t=e.sent,this.setState({roadObjectTypes:t});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleRegistration",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.post("/api/registerIssue",t);case 2:if(200===(n=e.sent).status){e.next=5;break}throw Error(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getIssues",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.get("/api/getIssues");case 2:t=e.sent,this.setState({issues:t.data});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"testApiSkriv",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.post("http://localhost:8010/ws/no/vegvesen/ikt/sikkerhet/aaa/autentiser",{headers:{"Content-Type":"application/json"},body:{username:"bjosor",password:"bjosor"}});case 2:t=e.sent,console.log(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"altTestApiSkriv",value:function(){var e=new XMLHttpRequest;e.onreadystatechange=function(){4==this.readyState&&200==this.status&&console.log(e.responseText)},e.open("POST","http://localhost:8010/ws/no/vegvesen/ikt/sikkerhet/aaa/autentiser",!0),e.setRequestHeader("Content-type","application/json"),e.send({username:"bjosor",password:"bjosor"})}}]),n}(a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(z,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[48,1,2]]]);
//# sourceMappingURL=main.dc056d12.chunk.js.map