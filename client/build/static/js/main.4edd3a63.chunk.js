(this["webpackJsonpreact-with-leaflet"]=this["webpackJsonpreact-with-leaflet"]||[]).push([[0],{37:function(e,t,n){e.exports=n.p+"static/media/venue_location_icon.bd6f36a3.svg"},38:function(e,t,n){e.exports=n.p+"static/media/red_marker.33539eeb.png"},50:function(e,t,n){e.exports=n(80)},79:function(e,t,n){},80:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(24),s=n.n(i),o=n(9),c=n.n(o),l=n(17),u=n(7),h=n(8),d=n(10),p=n(13),m=n(12),v=n(18),f=n.n(v),g=new(function(){function e(){Object(u.a)(this,e),this._data={}}return Object(h.a)(e,[{key:"add",value:function(e,t){this._data[e]=t}},{key:"get",value:function(e){return e in this._data?this._data[e]:[]}}]),e}());Object.freeze(g);var b=function(){function e(t){Object(u.a)(this,e),this.endpoint=t}return Object(h.a)(e,[{key:"apiCall",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.get(this.endpoint+t,{headers:{Accept:"application/vnd.vegvesen.nvdb-v3-rev1+json"}});case 2:n=e.sent,a=n.data.objekter,console.log(n);case 5:if(1e3!==n.data.metadata.returnert){e.next=12;break}return e.next=8,f.a.get(n.data.metadata.neste.href,{headers:{Accept:"application/vnd.vegvesen.nvdb-v3-rev1+json"}});case 8:n=e.sent,a=a.concat(n.data.objekter),e.next=5;break;case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),k=n(39),y=n(44),j=n(40),O=n(43),w=n(42),x=n(41),C=n(2),E=n.n(C),M=E.a.icon({iconUrl:n(37),iconRetinaUrl:n(37),iconAnchor:null,shadowUrl:null,shadowSize:null,shadowAnchor:null,iconSize:[35,35],className:"leaflet-venue-icon"}),R=E.a.icon({iconUrl:n(38),iconRetinaUrl:n(38),iconAnchor:null,shadowUrl:null,shadowSize:null,shadowAnchor:null,iconSize:[35,35],className:"leaflet-venue-icon"}),S=n(47),F=n.n(S),N=(n(77),n(78),function(e){Object(p.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this,e)).state={zoom:15,contextMenu:!1},n.handleClick=n.handleClick.bind(Object(d.a)(n)),n}return Object(h.a)(a,[{key:"render",value:function(){return r.a.createElement(k.a,{center:this.props.currentLocation,zoom:this.state.zoom,maxZoom:19,onclick:this.handleClick},r.a.createElement(y.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),this.drawIssueMarkers(this.props.issues),r.a.createElement(F.a,{spiderfyOnMaxZoom:!1,disableClusteringAtZoom:18},0!==this.props.filters.length&&this.drawMapObjects(this.props.map),this.drawRoads(this.props.roads)))}},{key:"drawIssueMarkers",value:function(e){return e.map((function(e,t){return r.a.createElement(j.a,{position:e.geometry.coordinates,key:t,icon:M},r.a.createElement(O.a,null,e.properties.name+" "+e.properties.date))}))}},{key:"drawMapObjects",value:function(e){var t=this;return console.log(e),e.map((function(e,a){try{if(!t.props.filters.includes(e.metadata.type.id))return null;var i=n(45)(e.geometri.wkt);if("Point"===i.type){var s=[i.coordinates[0],i.coordinates[1]];return r.a.createElement(j.a,{position:s,key:a,icon:t.getIcon(e.metadata.type.id),onClick:t.props.handleMarkerClick})}if("LineString"===i.type){var o=Array.from(i.coordinates.map((function(e){return e.slice(0,2)})));return r.a.createElement(w.a,{color:"red",positions:o,key:a})}if("Polygon"===i.type){var c=i.coordinates;return r.a.createElement(x.a,{color:"red",positions:c,key:a})}return console.log("Invalid geoJSON: "+i.type),console.log(i),null}catch(l){return console.log(e),console.log(l),null}}))}},{key:"drawRoads",value:function(e){console.log(e);var t=n(45);return e.map((function(e,n){var a=t(e.geometri.wkt),i=Array.from(a.coordinates.map((function(e){return e.slice(0,2)})));return r.a.createElement(w.a,{color:"red",positions:i,key:n})}))}},{key:"getIcon",value:function(e){return{79:R,83:M,87:M}[e]}},{key:"handleClick",value:function(e){this.props.onClick(e)}}]),a}(a.Component)),I=n(49),L=function(e){Object(p.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).state={type:"",date:"",latitude:a.props.point.lat,longitude:a.props.point.lng},a.handleChange=a.handleChange.bind(Object(d.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(d.a)(a)),a}return Object(h.a)(n,[{key:"render",value:function(){return this.props.show?r.a.createElement("div",{className:"caseRegistration"},r.a.createElement("form",{className:"caseRegistration-form",onSubmit:this.handleSubmit},r.a.createElement("label",{className:"caseRegistration-form-label"},"Sakstype",r.a.createElement("input",{name:"type",type:"text",className:"caseRegistration-form-input",value:this.state.type,onChange:this.handleChange})),r.a.createElement("label",{className:"caseRegistration-form-label"},"Dato",r.a.createElement("input",{name:"date",type:"text",className:"caseRegistration-form-input",value:this.state.date,onChange:this.handleChange})),r.a.createElement("label",{className:"caseRegistration-form-label"},"Sted",r.a.createElement("input",{name:"latitude",type:"text",className:"caseRegistration-form-input",value:this.state.latitude,onChange:this.handleChange}),r.a.createElement("input",{name:"longitude",type:"text",className:"caseRegistration-form-input",value:this.state.longitude,onChange:this.handleChange})),r.a.createElement("input",{type:"submit",className:"caseRegistration-form-input"}))):r.a.createElement("div",null)}},{key:"handleChange",value:function(e){var t=e.target,n=t.value,a=t.name;this.setState(Object(I.a)({},a,n))}},{key:"handleSubmit",value:function(e){var t={type:"Feature",geometry:{type:"Point",coordinates:[this.state.latitude,this.state.longitude]},properties:{name:this.state.type,date:this.state.date}};this.props.handleRegistration(t),e.preventDefault()}}]),n}(a.Component),P=function(e){Object(p.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).state={mainMenu:!0},a}return Object(h.a)(n,[{key:"componentWillReceiveProps",value:function(e){e.caseRegistration!==this.props.caseRegistration&&this.setState({caseRegistration:e.caseRegistration})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"Menu"},this.state.mainMenu&&r.a.createElement("div",{className:"main-menu"},r.a.createElement("header",null,"Hoved Meny"),r.a.createElement("button",null,"Registrer objekt"),r.a.createElement("button",{onClick:function(){e.setState((function(e){return{caseRegistration:!e.caseRegistration}}))}},"Registrer sak")),r.a.createElement(L,{show:this.state.caseRegistration,point:this.props.latlng,handleRegistration:this.props.handleRegistration}))}}]),n}(a.Component),A=function(e){Object(p.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).state={listOpen:!1,headerTitle:a.props.title,list:a.props.list,selected:a.props.selected},a}return Object(h.a)(n,[{key:"toggleList",value:function(){this.setState((function(e){return{listOpen:!e.listOpen}}))}},{key:"addFilter",value:function(e){var t=this;this.setState((function(n){return t.props.addFilter(e),{selected:n.selected.concat(e)}}))}},{key:"removeFilter",value:function(e){var t=this;this.setState((function(n){return t.props.removeFilter(e),{selected:n.selected.filter((function(t){return t!==e}))}}))}},{key:"render",value:function(){var e=this,t=this.props.list,n=this.state,a=n.listOpen,i=n.headerTitle;return r.a.createElement("div",{className:"dd-wrapper"},r.a.createElement("div",{className:"dd-header",onClick:function(){return e.toggleList()}},this.state.selected.length?this.state.selected.map((function(t){return r.a.createElement("div",{className:"test",key:t.nummer},t.navn,r.a.createElement("button",{className:"removeFilter",onClick:function(){return e.removeFilter(t)}},"X"))})):r.a.createElement("div",{className:"dd-header-title"},i)),a&&r.a.createElement("ul",{className:"dd-list"},t.map((function(t){return r.a.createElement("li",{className:"dd-list-item",key:t.nummer,onClick:function(){return e.addFilter(t)}},t.navn)}))))}}]),n}(a.Component),U=function(e){Object(p.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).state={expanded:!1,height:"40px",width:"40px",municipalities:[],roadObjects:[]},a.toggleWindow=a.toggleWindow.bind(Object(d.a)(a)),a.addFilter=a.addFilter.bind(Object(d.a)(a)),a.removeFilter=a.removeFilter.bind(Object(d.a)(a)),a}return Object(h.a)(n,[{key:"toggleWindow",value:function(){this.state.expanded?this.setState({height:"40px",width:"40px"}):this.setState({height:"500px",width:"200px"}),this.setState((function(e){return{expanded:!e.expanded}}))}},{key:"addFilter",value:function(e){var t=this;this.setState((function(n){return t.props.handleFilters(n.roadObjects.concat(e.nummer)),{roadObjects:n.roadObjects.concat(e.nummer)}}))}},{key:"removeFilter",value:function(e){var t=this;this.setState((function(n){return t.props.handleFilters(n.roadObjects.filter((function(t){return t!==e.nummer}))),{roadObjects:n.roadObjects.filter((function(t){return t!==e.nummer}))}}))}},{key:"render",value:function(){return r.a.createElement("div",{className:"mapfilter-container",style:{height:this.state.height,width:this.state.width}},this.state.expanded&&r.a.createElement(A,{title:"Velg vegobjekt",list:[{navn:"Stikkrenne/kulvert",nummer:79},{navn:"Kum",nummer:83},{navn:"Belysningspunkt",nummer:87}],selected:this.state.roadObjects,addFilter:this.addFilter,removeFilter:this.removeFilter}),r.a.createElement("button",{className:"mapfilter-toggle",onClick:this.toggleWindow},this.state.expanded?">":"<"))}}]),n}(a.Component),z=function(e){Object(p.a)(n,e);var t=Object(m.a)(n);function n(e){return Object(u.a)(this,n),t.call(this,e)}return Object(h.a)(n,[{key:"render",value:function(){var e=this.props.details.x+"px",t=this.props.details.y+"px";return r.a.createElement("div",{className:"ContextMenu",style:{left:e,top:t}},r.a.createElement("button",{onClick:this.props.handleClick},"Hendelse"),r.a.createElement("button",null,"Nytt objekt"))}}]),n}(a.Component),_=function(e){Object(p.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).state={contextMenu:{show:!1}},a.swiping=!1,a.handleClick=a.handleClick.bind(Object(d.a)(a)),a.handleContextClick=a.handleContextClick.bind(Object(d.a)(a)),a}return Object(h.a)(n,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"Container",onMouseDown:function(){e.swiping=!1},onMouseMove:function(){e.swiping=!0}},r.a.createElement(P,{issueRegistration:this.state.issueRegistration,latlng:{lat:this.state.contextMenu.lat,lng:this.state.contextMenu.lng},handleRegistration:this.props.handleRegistration}),this.state.contextMenu.show&&r.a.createElement(z,{details:this.state.contextMenu,handleClick:this.handleContextClick}),r.a.createElement(N,{currentLocation:this.props.currentLocation,map:this.props.map,filters:this.props.filters,roads:this.props.roads,issues:this.props.issues,onClick:this.handleClick}),r.a.createElement(U,{data:this.state.menu,handleFilters:this.props.handleFilters}))}},{key:"handleClick",value:function(e){var t=e.originalEvent;!t.target.classList.contains("leaflet-container")||this.state.contextMenu.show||this.swiping?t.target.classList.contains("ContextMenu")||this.setState({contextMenu:{show:!1}}):this.setState({contextMenu:{show:!0,x:t.pageX,y:t.pageY,lat:e.latlng.lat,lng:e.latlng.lng}}),this.props.testRoadSelect(e.latlng.lat,e.latlng.lng)}},{key:"handleContextClick",value:function(){this.setState((function(e){return{issueRegistration:!0,contextMenu:{show:!1,lat:e.contextMenu.lat,lng:e.contextMenu.lng}}}))}}]),n}(a.Component),W=(n(79),function(e){Object(p.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).state={nvdbEndpoint:"https://nvdbapiles-v3.utv.atlas.vegvesen.no/",currentLocation:{lat:60.0084857,lng:11.0648648},menu:"mainMenu",map:[],filters:[],roads:[],issues:[],filterOnRoad:!1},a.nvdb=new b(a.state.nvdbEndpoint),a.handleFilters=a.handleFilters.bind(Object(d.a)(a)),a.getUserLocation=a.getUserLocation.bind(Object(d.a)(a)),a.testRoadSelect=a.testRoadSelect.bind(Object(d.a)(a)),a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:navigator.geolocation.getCurrentPosition(this.getUserLocation),this.getIssues(),this.testApiSkriv();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement(_,{currentLocation:this.state.currentLocation,map:this.state.map,filters:this.state.filters,roads:this.state.roads,issues:this.state.issues,handleFilters:this.handleFilters,handleRegistration:this.handleRegistration,testRoadSelect:this.testRoadSelect})}},{key:"getPolygonString",value:function(e){var t="";return e.forEach((function(e){t=t+e.lat+" "+e.lng+","})),t.slice(0,-1)}},{key:"getCircle",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=[],r=0,i=(2*Math.PI-r)/n,s=0;s<n;s++)a.push(r),r+=i;t/=6371,e={lat:e.lat*(Math.PI/180),lng:e.lng*(Math.PI/180)};var o=[];return a.forEach((function(n){var a,r=Math.asin(Math.sin(e.lat)*Math.cos(t)+Math.cos(e.lat)*Math.sin(t)*Math.cos(n));a=0===Math.cos(r)?e.lng:(e.lng-Math.asin(Math.sin(n)*Math.sin(t)/Math.cos(r))+Math.PI)%(2*Math.PI)-Math.PI,o.push({lat:r*(180/Math.PI),lng:a*(180/Math.PI)})})),o.push(o[0]),o}},{key:"getUserLocation",value:function(e){this.setState({currentLocation:{lat:e.coords.latitude,lng:e.coords.longitude}})}},{key:"handleFilters",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,i=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],this.setState({filters:t}),this.state.filterOnRoad?(a=this.state.filterOnRoad,console.log(a),t&&(t.forEach(function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.push(i.nvdb.apiCall("vegobjekter/"+t+"?inkluder=alle&srid=4326&veglenkesekvens="+a));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Promise.all(n).then((function(e){i.setState({map:[].concat.apply([],e)})})))):(r=this.getPolygonString(this.getCircle(this.state.currentLocation)),t&&(t.forEach(function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.push(i.nvdb.apiCall("vegobjekter/"+t+"?inkluder=alle&srid=4326&polygon="+r));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Promise.all(n).then((function(e){i.setState({map:[].concat.apply([],e)})}))));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleRegistration",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.post("/api/registerIssue",t);case 2:if(200===(n=e.sent).status){e.next=5;break}throw Error(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getIssues",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.get("/api/getIssues");case 2:t=e.sent,this.setState({issues:t.data});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"testRoadSelect",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n){var a=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:f.a.get(this.state.nvdbEndpoint+"posisjon?lat="+t+"&lon="+n+"&srid=4326&maks_avstand=200").then((function(e){f.a.get(a.state.nvdbEndpoint+"vegnett/veglenkesekvenser/"+e.data[0].veglenkesekvens.veglenkesekvensid+"?srid=4326").then((function(t){a.setState({roads:t.data.veglenker,filterOnRoad:e.data[0].veglenkesekvens.veglenkesekvensid})}))}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"testApiSkriv",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.post("http://localhost:8010/ws/no/vegvesen/ikt/sikkerhet/aaa/autentiser",{username:"bjosor",password:"bjosor"},{headers:{"Content-Type":"application/json"}});case 2:t=e.sent,console.log(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(W,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[50,1,2]]]);
//# sourceMappingURL=main.4edd3a63.chunk.js.map